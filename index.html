<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TYPECRAFT</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --accent: #00f0ff;
    --accent2: #ff6b6b;
    --text: #e2e8f0;
    --muted: #4a5568;
    --correct: #48bb78;
    --wrong: #fc5c5c;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Share Tech Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    overflow: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,240,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,240,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 720px;
  }

  .title {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.4rem;
    font-weight: 900;
    text-align: center;
    letter-spacing: 12px;
    color: var(--accent);
    text-shadow: 0 0 20px rgba(0,240,255,0.4);
    margin-bottom: 8px;
  }
  .subtitle {
    text-align: center;
    color: var(--muted);
    font-size: 0.75rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 28px;
  }

  .stats {
    display: flex;
    justify-content: space-between;
    background: var(--surface);
    border: 1px solid rgba(0,240,255,0.15);
    border-radius: 8px;
    padding: 12px 20px;
    margin-bottom: 16px;
  }
  .stat { text-align: center; }
  .stat-label {
    font-size: 0.6rem;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 2px;
  }
  .stat-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--accent);
  }

  .timer-track {
    width: 100%;
    height: 4px;
    background: var(--surface);
    border-radius: 2px;
    margin-bottom: 16px;
    overflow: hidden;
  }
  .timer-fill {
    height: 100%;
    width: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius: 2px;
    transition: width 0.2s linear;
  }

  .text-box {
    background: var(--surface);
    border: 1px solid rgba(0,240,255,0.15);
    border-radius: 10px;
    padding: 24px;
    margin-bottom: 16px;
    min-height: 130px;
    line-height: 2.4;
    font-size: 1.05rem;
    word-break: break-word;
    position: relative;
    overflow: hidden;
  }

  .char {
    color: var(--muted);
    display: inline-block;
    transition: color 0.1s;
  }
  .char.correct { color: var(--correct); }

  .char.shake {
    color: var(--wrong);
    text-shadow: 0 0 8px rgba(252,92,92,0.7), 0 0 20px rgba(252,92,92,0.4);
    animation: errorPulse 0.35s ease-out forwards;
  }
  @keyframes errorPulse {
    0%   { transform: translateX(0); color: var(--wrong); text-shadow: 0 0 12px rgba(252,92,92,0.9), 0 0 28px rgba(252,92,92,0.5); }
    25%  { transform: translateX(-3px); }
    50%  { transform: translateX(3px); }
    75%  { transform: translateX(-2px); }
    100% { transform: translateX(0); color: var(--wrong); text-shadow: 0 0 6px rgba(252,92,92,0.5); }
  }

  .char.current {
    color: var(--text);
    border-bottom: 2px solid var(--accent);
    animation: blink 0.8s infinite;
  }
  @keyframes blink {
    0%, 100% { border-color: var(--accent); }
    50%      { border-color: transparent; }
  }

  .hidden-input {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    top: 0; left: 0;
    cursor: text;
    font-size: 1px;
  }

  .btn-row { text-align: center; }
  .btn {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    background: transparent;
    color: var(--accent);
    border: 1px solid var(--accent);
    border-radius: 6px;
    padding: 10px 32px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn:hover {
    background: var(--accent);
    color: var(--bg);
    box-shadow: 0 0 16px rgba(0,240,255,0.35);
  }

  .overlay {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(10,14,26,0.85);
    backdrop-filter: blur(6px);
  }
  .overlay.hidden { display: none; }
  .card {
    background: var(--surface);
    border: 1px solid rgba(0,240,255,0.2);
    border-radius: 14px;
    padding: 40px 48px;
    text-align: center;
    max-width: 380px;
    width: 90%;
    box-shadow: 0 0 40px rgba(0,240,255,0.08);
  }
  .card h2 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.4rem;
    color: var(--accent);
    margin-bottom: 12px;
    letter-spacing: 4px;
  }
  .card p {
    color: var(--muted);
    font-size: 0.82rem;
    line-height: 1.8;
    margin-bottom: 20px;
  }
  .result-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
  }
  .result-item {
    background: rgba(0,240,255,0.05);
    border: 1px solid rgba(0,240,255,0.1);
    border-radius: 8px;
    padding: 12px 8px;
  }
  .result-item .stat-label { margin-bottom: 4px; }
  .result-item .stat-value { font-size: 1.5rem; }

  .hint { color: var(--muted); font-size: 0.7rem; letter-spacing: 1px; margin-top: 12px; text-align: center; }
</style>
</head>
<body>

<!-- START -->
<div class="overlay" id="startOverlay">
  <div class="card">
    <h2>TYPECRAFT</h2>
    <p>Type as many characters as you can in 30 seconds.<br><br>Mistakes must be corrected —<br>you cannot advance until the current character is typed correctly.</p>
    <div class="btn-row"><button class="btn" onclick="startGame()">START</button></div>
  </div>
</div>

<!-- RESULT -->
<div class="overlay hidden" id="resultOverlay">
  <div class="card">
    <h2>RESULT</h2>
    <div class="result-grid">
      <div class="result-item">
        <div class="stat-label">WPM</div>
        <div class="stat-value" id="reswpm">0</div>
      </div>
      <div class="result-item">
        <div class="stat-label">Accuracy</div>
        <div class="stat-value" id="resacc">0%</div>
      </div>
      <div class="result-item">
        <div class="stat-label">Correct</div>
        <div class="stat-value" id="rescor">0</div>
      </div>
      <div class="result-item">
        <div class="stat-label">Errors</div>
        <div class="stat-value" id="reserr">0</div>
      </div>
    </div>
    <div class="btn-row"><button class="btn" onclick="resetGame()">RETRY</button></div>
  </div>
</div>

<!-- MAIN -->
<div class="container">
  <div class="title">TYPECRAFT</div>
  <div class="subtitle">Speed · Accuracy · Precision</div>

  <div class="stats">
    <div class="stat"><div class="stat-label">WPM</div><div class="stat-value" id="wpm">0</div></div>
    <div class="stat"><div class="stat-label">Time</div><div class="stat-value" id="time">30</div></div>
    <div class="stat"><div class="stat-label">Accuracy</div><div class="stat-value" id="acc">100%</div></div>
    <div class="stat"><div class="stat-label">Errors</div><div class="stat-value" id="err">0</div></div>
  </div>

  <div class="timer-track"><div class="timer-fill" id="timerFill"></div></div>

  <div class="text-box" id="textBox" onclick="document.getElementById('hiddenInput').focus()">
    <input class="hidden-input" id="hiddenInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  </div>

  <div class="btn-row" style="margin-top:8px;">
    <button class="btn" id="startBtn" onclick="startGame()">START</button>
  </div>
  <p class="hint" id="hintText">Start typing to begin</p>
</div>

<script>
const WORDS = [
  "the","be","to","of","and","a","in","that","have","it",
  "for","not","on","with","he","as","you","do","at","this",
  "but","his","by","from","they","we","say","her","she","or",
  "an","will","my","one","all","would","there","their","what","so",
  "up","out","if","about","who","get","which","go","me","when",
  "make","can","like","time","no","just","him","know","take","people",
  "into","year","your","good","some","could","them","see","other","than",
  "then","now","look","only","come","its","over","think","also","back",
  "after","use","two","how","our","work","first","well","way","even",
  "new","want","because","any","these","give","day","most","us","great",
  "between","need","large","often","hand","high","place","hold","free","real",
  "life","few","north","open","seem","together","next","white","children","begin",
  "got","walk","example","ease","paper","group","always","music","those","both",
  "mark","book","letter","until","mile","river","car","feet","care","second",
  "enough","plain","girl","usual","young","ready","above","ever","red","list",
  "though","feel","talk","bird","soon","body","dog","family","direct","pose",
  "leave","song","measure","door","product","black","short","class","wind",
  "question","happen","complete","ship","area","half","rock","order","fire","south",
  "problem","piece","told","knew","pass","since","top","whole","king","space",
  "heard","best","hour","better","true","during","hundred","remember","step","early",
  "west","ground","interest","reach","fast","sing","listen","six",
  "table","travel","less","morning","ten","simple","several","toward","war",
  "lay","against","pattern","slow","center","love","person","money","serve","appear",
  "road","map","science","rule","govern","pull","cold","notice","voice","unit",
  "power","town","fine","certain","fly","lead","cry","dark","machine","note",
  "wait","plan","figure","star","box","noun","field","rest","correct","able",
  "pound","done","beauty","drive","stood","contain","front","teach","week","final",
  "gave","green","quick","develop","ocean","warm","minute","strong",
  "special","mind","behind","clear","tail","produce","fact","street","inch","lot",
  "nothing","course","stay","wheel","full","force","blue","object","decide","surface"
];

const TOTAL_TIME = 30;
let text = '';
let idx = 0;
let errors = 0;
let correctChars = 0;
let totalTyped = 0;
let gameActive = false;
let startTime = null;
let timerInterval = null;
let timeLeft = TOTAL_TIME;
let shaking = false;

function generateText() {
  let t = '';
  while (t.length < 300) {
    t += WORDS[Math.floor(Math.random() * WORDS.length)] + ' ';
  }
  return t.trim();
}

function renderText() {
  const box = document.getElementById('textBox');
  let html = '';
  for (let i = 0; i < text.length; i++) {
    const ch = text[i] === ' ' ? '&nbsp;' : text[i];
    let cls = 'char';
    if (i < idx) cls += ' correct';
    else if (i === idx) cls += ' current';
    html += `<span class="${cls}" id="c${i}">${ch}</span>`;
  }
  box.innerHTML = html + '<input class="hidden-input" id="hiddenInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">';
  document.getElementById('hiddenInput').addEventListener('keydown', onKeyDown);
  if (gameActive) document.getElementById('hiddenInput').focus();
}

function onKeyDown(e) {
  if (e.composing) return;
  if (e.key.length !== 1) return;
  e.preventDefault();

  if (!gameActive) startGame();
  if (shaking) return;

  totalTyped++;

  if (e.key === text[idx]) {
    // ── 正解 ──
    const span = document.getElementById('c' + idx);
    if (span) span.className = 'char correct';
    correctChars++;
    idx++;

    if (idx >= text.length) {
      text += ' ' + generateText();
      renderText();
    } else {
      const next = document.getElementById('c' + idx);
      if (next) next.className = 'char current';
    }
  } else {
    // ── 誤解: shake して同じ文字の再入力を求める ──
    errors++;
    shaking = true;
    const span = document.getElementById('c' + idx);
    if (span) {
      span.className = 'char shake';
      span.addEventListener('animationend', function handler() {
        span.removeEventListener('animationend', handler);
        span.className = 'char current';
        shaking = false;
      }, { once: true });
    } else {
      shaking = false;
    }
  }
  updateStats();
}

function updateStats() {
  const elapsed = gameActive ? (Date.now() - startTime) / 1000 : 0;
  const minutes = elapsed / 60 || 1;
  const wpm = Math.round((correctChars / 5) / minutes);
  const acc = totalTyped > 0 ? Math.round((correctChars / totalTyped) * 100) : 100;
  document.getElementById('wpm').textContent = wpm;
  document.getElementById('acc').textContent = acc + '%';
  document.getElementById('err').textContent = errors;
}

function startGame() {
  if (gameActive) return;
  document.getElementById('startOverlay').classList.add('hidden');
  text = generateText();
  idx = 0;
  errors = 0;
  correctChars = 0;
  totalTyped = 0;
  shaking = false;
  timeLeft = TOTAL_TIME;
  gameActive = true;
  startTime = Date.now();
  document.getElementById('startBtn').style.display = 'none';
  document.getElementById('hintText').style.display = 'none';
  renderText();
  document.getElementById('hiddenInput').focus();

  timerInterval = setInterval(() => {
    timeLeft--;
    document.getElementById('time').textContent = timeLeft;
    document.getElementById('timerFill').style.width = (timeLeft / TOTAL_TIME * 100) + '%';
    if (timeLeft <= 0) endGame();
  }, 1000);
}

function endGame() {
  clearInterval(timerInterval);
  gameActive = false;
  shaking = false;
  const acc = totalTyped > 0 ? Math.round((correctChars / totalTyped) * 100) : 100;
  const wpm = Math.round((correctChars / 5) / (TOTAL_TIME / 60));
  document.getElementById('reswpm').textContent = wpm;
  document.getElementById('resacc').textContent = acc + '%';
  document.getElementById('rescor').textContent = correctChars;
  document.getElementById('reserr').textContent = errors;
  document.getElementById('resultOverlay').classList.remove('hidden');
}

function resetGame() {
  clearInterval(timerInterval);
  document.getElementById('resultOverlay').classList.add('hidden');
  gameActive = false;
  idx = 0;
  errors = 0;
  correctChars = 0;
  totalTyped = 0;
  shaking = false;
  timeLeft = TOTAL_TIME;
  document.getElementById('time').textContent = TOTAL_TIME;
  document.getElementById('timerFill').style.width = '100%';
  document.getElementById('wpm').textContent = '0';
  document.getElementById('acc').textContent = '100%';
  document.getElementById('err').textContent = '0';
  document.getElementById('startBtn').style.display = 'inline-block';
  document.getElementById('hintText').style.display = 'block';
  text = generateText();
  renderText();
}

// Init
text = generateText();
renderText();
</script>
</body>
</html>